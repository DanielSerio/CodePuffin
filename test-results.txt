
Running 8 tests using 1 worker

  âœ“  1 tests\integration\cli-errors.test.ts:9:7 â€º CLI error handling â€º --help displays usage information (512ms)
  âœ“  2 tests\integration\cli-errors.test.ts:20:7 â€º CLI error handling â€º --version displays version number (687ms)
  âœ“  3 tests\integration\cli-errors.test.ts:30:7 â€º CLI error handling â€º scan with invalid directory completes with 0 files (533ms)
  âœ“  4 tests\integration\cli-errors.test.ts:41:7 â€º CLI error handling â€º scan with --config pointing to missing file shows error (628ms)
  âœ˜  5 tests\integration\cli-errors.test.ts:54:7 â€º CLI error handling â€º scan with malformed config file shows parse error (619ms)
  âœ˜  6 tests\integration\cli-errors.test.ts:66:7 â€º CLI error handling â€º scan with invalid schema in config file shows validation error (452ms)
  âœ“  7 tests\integration\cli-errors.test.ts:82:7 â€º CLI error handling â€º scan with -c short option works (547ms)
  âœ“  8 tests\integration\cli-errors.test.ts:95:7 â€º CLI error handling â€º unknown command shows help (464ms)


  1) tests\integration\cli-errors.test.ts:54:7 â€º CLI error handling â€º scan with malformed config file shows parse error 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoContain[2m([22m[32mexpected[39m[2m) // indexOf[22m

    Expected substring: [32m"Failed to load config file: Unexpected token"[39m
    Received string:    [31m"[39m
    [31mðŸš€ Starting scan in ....Â·[39m
    [31mâœ– Invalid configuration:[39m
    [31mFailed to load config file: Unexpected end of JSON input[39m
    [31m"[39m

      61 |     });
      62 |     const output = result.stdout + result.stderr;
    > 63 |     expect(output).toContain('Failed to load config file: Unexpected token');
         |                    ^
      64 |   });
      65 |
      66 |   test('scan with invalid schema in config file shows validation error', () => {
        at C:\developer\code-scanner\tests\integration\cli-errors.test.ts:63:20

  2) tests\integration\cli-errors.test.ts:66:7 â€º CLI error handling â€º scan with invalid schema in config file shows validation error 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoContain[2m([22m[32mexpected[39m[2m) // indexOf[22m

    Expected substring: [32m"Invalid CodePuffin configuration"[39m
    Received string:    [31m"[39m
    [31mðŸš€ Starting scan in ....Â·[39m
    [31mâœ– Invalid configuration:[39m
    [31m{[39m
    [31m  \"_errors\": [],[39m
    [31m  \"rules\": {[39m
    [31m    \"_errors\": [],[39m
    [31m    \"line-limits\": {[39m
    [31m      \"_errors\": [],[39m
    [31m      \"severity\": {[39m
    [31m        \"_errors\": [[39m
    [31m          \"Invalid enum value. Expected 'error' | 'warn', received 'super-error'\"[39m
    [31m        ][39m
    [31m      }[39m
    [31m    }[39m
    [31m  }[39m
    [31m}[39m
    [31m"[39m

      76 |
      77 |     expect(result.status).toBe(1);
    > 78 |     expect(output).toContain('Invalid CodePuffin configuration');
         |                    ^
      79 |     expect(output).toContain('severity');
      80 |   });
      81 |
        at C:\developer\code-scanner\tests\integration\cli-errors.test.ts:78:20

  2 failed
    tests\integration\cli-errors.test.ts:54:7 â€º CLI error handling â€º scan with malformed config file shows parse error 
    tests\integration\cli-errors.test.ts:66:7 â€º CLI error handling â€º scan with invalid schema in config file shows validation error 
  6 passed (11.1s)
